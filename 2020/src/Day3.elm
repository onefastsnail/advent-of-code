module Day3 exposing (..)

import Array exposing (Array)
import List


puzzleInput : String
puzzleInput =
    "..#.#...#.#.#.##.....###.#....#\n...........##.#...#.#..........\n....#.....#..#.............#...\n.#....###..##...#...##...#.#..#\n#.......#.........#..#.......#.\n...#.##..##...#.#......#.##.#..\n#.#..##.....#.....#..##........\n...#.####...#.##...#...........\n.#...#..#..#....#.#.#.#.##.....\n##.#..#.##..#......#..##.#.#..#\n.#.##.....#.#...............#.#\n..##.#.....#.....##..##.#....#.\n#..#..........#...##........#..\n#..##.#.#...............#..#...\n..#....#...#.......#.......#...\n.........#.#.##.#........#.....\n#...##....#..#.........#.#...##\n...#.#...#...........#..#...#..\n...#..#........#...#...........\n.#....##.#...#.#....#....##....\n...#...#......#.#.......#...##.\n####..........##....#..........\n#..#...........................\n#....#...####..##.#......#.#...\n..#..#.....##.....#...#....#..#\n#.##......#..##........#.......\n..........#.....#...#.#.#....##\n....##...##..#........#...#..#.\n#..#..#...##..............##...\n###.##..##.###...#....##.#..#..\n.#......#.................#.#..\n#.#..#.##.#.#.#.....#.........#\n..##......#.......##........#..\n#..............#.##.#.....#....\n............................##.\n..#.##......#..........#....#..\n..##.....#..##.#....#.......##.\n..#.#.##.#.........#...........\n...........##.#.#...#......###.\n#....#...#........#.#...#.#.###\n..............#...#.....##....#\n#...#...#..............#..#...#\n.##..#.........#.##.#..#...##..\n.....#.........#..#..#.......#.\n.#......#.#.#....##..#...#..##.\n#....................#.#....#..\n......#.....##............#....\n.#.....#......####.....#....##.\n##.####.#..#..........#......#.\n##....................#..##....\n.....#...#.#.##.#.###.....#....\n.#..#...####.#.#...#.#.....#...\n#.....##.........##.##.##.....#\n....#....##.###.........#...###\n.......#........#.##.....#####.\n...#.##..#...#...####.....##...\n..#....#....#......#......#.#..\n...#.#.#.........#.......#..#..\n.....#...........#.#........##.\n..##...#.#.##.#.#.#...###.#....\n..##.............###....#.#....\n#.......#....#..#...#..##..#...\n....##..#.......####....#..#.##\n##....#...#.#.#...#...#........\n....#.#................#...#...\n...#.....#.#.......##....#.#..#\n#....##.#...#.#..#.#.........#.\n#..##.........##.....#...#.....\n....#.....#.#..#..##..##.##...#\n#.....#...#.#.#.##....#.#.##...\n.#.#........#..##.......#...#.#\n..###.....#..#.##....#...#....#\n...#..###...#...#.......#..#...\n.#....##.......#.#..........##.\n...#.#.............##.....##...\n..#..#...#.....#...#...........\n.#.#......#.##....#.....#......\n........#.#.....#.#...#..#.#..#\n#.....#.#.....#.##..#.#....#.#.\n..#..###.#.#........#.....##..#\n#.#....#......#.#....###..#...#\n...#.#....#..#.##.....#...#....\n....##....#.#...#.........#..##\n.#......#...#.............#..#.\n#........#........#.#.....##...\n..##..#.##..#........#.........\n.....#...#...#..#.....#.#.##.#.\n..#..#..#.........#...#.......#\n....#.....#.......#.##.#.##..##\n......#.......##...#......#....\n....#....##.......###.#......#.\n.....#..#.#........#....#.....#\n#...#...#....#...###........#..\n#...........####.......#.#..#.#\n..###....#..........#...#.###..\n....#.#.....#....#..#.....#.##.\n...##.#..#..#.......#......#.#.\n....#......###..#.....#.....#..\n.....#.#.#.....#.##.#....####..\n.##....#.....#.#....##..#......\n#..#.....#..#...#....#.#.......\n.##.#..####..#.##.#......#.....\n......#....#.......##.##....#..\n...#....#....#..##.......##.###\n..##..........##.............#.\n.#...#.#...##..##.....#..#.....\n....#.#.##...................#.\n.......#.#..#....#.....#.......\n.#.#..#....####...#.#.##....#..\n.#.##...#..#..#...#.#.......#..\n##.#.....##.........#.......#..\n.##...#.....#.........##.#....#\n.............#..#............##\n...##.......#.....#.......#.##.\n##..##.........................\n.##.#........#........#........\n.....#................#.#......\n.............#....#....##....#.\n#..##...##...#..#.#............\n.......#...####.#..#..#.....##.\n..#.#..#......#.....#.#.#.....#\n...#..##........#..#.#....#.#..\n.#.....#..###..#....#.##.#...#.\n#.#..#.##.#..#......#.###...#..\n##..#.#..###....##.#...#...##.#\n##..#.........#...##......#....\n#.#...#.#..#..........#.......#\n.......#.#.......#.....##..#...\n........#..##............##.#..\n........##.....#........#..#...\n#..##.#..###......##...........\n..#.....#.#.#....#...#.#..#..##\n#...............#.......#.#.##.\n#..#.....#....#............#.#.\n...#....#...#....#..#..###.....\n..#....#.#.....#..#......##.#.#\n.#.#....#..#...#....#........#.\n..##....##....#.....#.#........\n.#...#....##..##.....##.....##.\n.#...........#....##...##.#....\n...#.....#......###.##.#.......\n......#.#..##.#.#....#...#...##\n....#...###.##....#.#.....#....\n.......#.....#......#.....##..#\n.####.#...##..#....#...........\n................###...#....#..#\n...#...#.....###.#.##.......#..\n..#....#...##...#.###......#.#.\n#...#......#............#.....#\n#.........#...............#..#.\n...#.##.....#............#.....\n........#......##..#..#..#.#..#\n....#....#.....#.#.....##..#...\n.....#....#..##.....#..........\n.##....#..#...........##.......\n#......##.....#...#.....#......\n...#.....#......#.#....#.......\n...#................##...#..#..\n........#..........#....#......\n......#....#.#.#...........#.#.\n.#............#....##.......##.\n#.......#.....#...##.#..##.....\n.#.....#.##..#..#....#.#..#.#.#\n....#...............###........\n#####...........#..#.......#..#\n...#.......#...#.#............#\n#...#..#.#...#.#...#.##.....##.\n.#..#..#..#.....#....#...#.....\n.#...#......#.......#.........#\n.#....#.....#...#...#..#....#..\n#....#....#.......#.....##.....\n.#...#.#.##.#....#..##........#\n..##...#............#..........\n..........#..#..#...#....#.....\n..#.......#....#.....##..##....\n.#...#......#...#..###...#...#.\n..##...#......#...#.#.#...#....\n.....#..#.#.#.#.#...#....##..#.\n##..#..##....#.#........##.#...\n.##..#.#...##..#....#..#.......\n.....#...#...#..#.#..#......#..\n.#.....##.##..#....####..#....#\n......##.................#....#\n....##.......###...#.##...##.#.\n...#...#.................##.#..\n.#.....##...#...#.....#.....##.\n##.........####..#...#...#....#\n...##.....#......#.###..#......\n.....###..##.#.......###..##...\n#....#...#.#...#...#.#....#..#.\n#...#.........##.#.........###.\n#....#..###..........##........\n.###.....#.#.....#........##..#\n....#.........##..#..#.#.#..#..\n..#......#...........#..##...#.\n...#.#..#..#...#.##..#..#.....#\n.#...#...#....................#\n..#..##..#.............#.....#.\n.....###.#.#.#...##..#.##....#.\n..#...####..##.#....#...#...#..\n.....#..#........#.#.#..#.##...\n#.#.........####..#...#.#......\n..............#..#........#....\n....#........#......#.........#\n#..#.##......#.#.......#....#..\n....#..............#.#.#..#....\n#.#......#.....##.......#..##..\n.#.#..........#....#......#....\n.....#.......#.##.....#......##\n...#...#.##.............####...\n..#....##...#...##..#.#..##.#..\n..#.........##.......###.#.....\n..#.........#####..##...#......\n..#.#...#.......#.####......##.\n......#.#.#....#......####....#\n.###...........#...#..#..#..##.\n..#...#..##.##...#.#.##.....#..\n.....#..#....##.......#...#....\n......#.....#.........#..#..#..\n...#..#.........##.....##.#...#\n....##...#......#..#.....#.....\n....#..#....#....#........##...\n##.....#.......#.....#.#.#..#..\n.....#..##.....##.##.#.........\n.#.#..##.............#.#.......\n......#.##.#.....#.#......#..#.\n..........#.#..#....#.#.#.#..##\n...##.....#..#...#...#...##....\n........#.#......#..###..#.....\n..#.##......#.......#.......#..\n...#....##.##.........#.#......\n......#....#.#.........#......#\n.....#...#....#...#......#..#..\n.##...#......#.........#...#.#.\n..#.#.#......#....#............\n..#.....##.............#.##.##.\n#......#......#...##.......#.#.\n##........#.....#..............\n.#.###.................#.#....#\n........##.#..##........#.#....\n.......###...#...##.#..#....#..\n.#..#....#..#......##......#...\n.#...#....#..........##..##.#..\n.#..###.......#............#...\n...#.....###.#..#........#.#.#.\n...#....#..#.##..........#.#.#.\n.#..##..#.....#...........#....\n#...#...##....#..#....##.......\n#..#......#................#...\n#..##....#.#..#......#.#.#.....\n##.#..#...#.....#.#...#......##\n#....#.#.#....#.....##.....##..\n....#...##.#...####.#.#.#.#..#.\n.....#.#....#..#.....#..#......\n.........#.#...................\n........#.....####......#..#..#\n.#.#.##.#...#.#......#...##.##.\n.#......#.#.#...#..#.......#...\n..#......#.##.##.#.#....#......\n..........#.#...###............\n.##..#..#.#.#..#.....#..#.#....\n......#.......#.#..#.#....#...#\n.#.......###......#...#.#.#....\n.............##..#..#...#....#.\n....#......#.#...#.#...#...#...\n..#....#.......#.#..#..#.#..#.#\n.#..#.#...#.....#.#...#####...#\n.##............#....#..........\n#.......####...#.#.#...........\n...#.......##.#..........#....#\n..#.#......#.......##.....#..##\n#......#.###..#......#......#.#\n##....#..#....#.##....#..#.....\n...##...#.#....#.#.......#.....\n#...####....#..#.#..#.##....###\n.....#..#..........###..#......\n.#..#..#...#....#.##..#..#.....\n#..#.....#....#..#.##...##.....\n.....###.#..#.......#...###.##.\n#..#........#.#..#.#.........#.\n....##........................#\n.#....#.#.#.#.#...#......#....#\n#....#...#.##.......#.#.###....\n..........###..##....#..##.#...\n...##..###...#.#.#.......##...#\n##.#...#..#.....###....#.......\n..#..##....###........##....###\n.....##..#...#..#.....#..#....#\n#................#....#...#..##\n#....#.#....#..###.#.#...#..#.#\n........##.#...#.#.#.#...#.....\n..#..###....#......##.#...##...\n..#..##....#.##..#.....#.....#.\n.#.#...#.....#..#..#......##.#.\n........#.#...#..##....#..#....\n...##...#...#...#...##...##..#.\n.......#..#..#....#.#..#...##..\n.#.....#.##........#...#.#.....\n##.#..#....#.#....#.#....#...#.\n..#.#......#.......##...#....#.\n#.#..####..#........#.......###\n....#.......#.......##.#...#.#.\n..#..#.#.............#..#......\n........###.....##....#.......#\n...#.....#...#...#....#.###....\n#...##.#........#..#...##..#..#\n...##..#....#....#.#.#...#.#...\n#......#.....#....###......##..\n.....#.........####...##..#....\n.......#...##...#..#..#.#......\n.#.#....#.....#.......#........\n...##...#....##..#.....###.....\n.#....#........##......#....#.#\n.........#.#.#.#...........#.#.\n....#.#..##......#.#.#..##.....\n.........#.....##....#.........\n....#.............#...........#\n...#..##........#.....###......\n#....#....#......#..#..#..#.#..\n#......##.....#..#....#..#.#...\n#..............#....#.#....###.\n..##..#..#...#...##........##..\n..#.##....#..#......###..#....."


type alias Line =
    List String


parsePuzzleInput : String -> List Line
parsePuzzleInput str =
    String.split "\n" str
        |> List.map (\line -> String.split "" line)


expandPuzzle : List Line -> List Line
expandPuzzle lines =
    List.foldl
        (\line accum ->
            let
                additions =
                    List.repeat (List.length lines) line |> List.concat

                newLine =
                    [ additions ] ++ [ line ] |> List.concat
            in
            List.append [ newLine ] accum
        )
        []
        lines
        |> List.reverse


isTreeHit : Line -> Int -> Bool
isTreeHit line x =
    List.drop x line
        |> List.head
        |> Maybe.withDefault ""
        |> (\a -> a == "#")


incrementCounter : Int -> Bool -> Int
incrementCounter count check =
    count
        + (case check of
            True ->
                1

            False ->
                0
          )


calculate : Int -> Int -> Int -> Int -> List Line -> Int
calculate count xPos yPos xJump lines =
    case lines of
        [] ->
            count

        _ ->
            let
                line =
                    List.drop yPos lines
                        |> List.head
                        |> Maybe.withDefault []
                        |> List.take (xPos + 1)

                treeCheck =
                    isTreeHit line xPos
            in
            calculate
                (incrementCounter count treeCheck)
                (xPos + xJump)
                yPos
                xJump
                (List.drop yPos lines)


multiplyTogether : List Int -> Basics.Int
multiplyTogether values =
    List.foldl (\i a -> i * a) 1 values


getAnswerPart1 : String -> Int
getAnswerPart1 puzzle =
    parsePuzzleInput puzzle
        |> expandPuzzle
        |> calculate 0 3 1 3


puzzleSlopes : List ( Int, Int )
puzzleSlopes =
    [ ( 1, 1 ), ( 3, 1 ), ( 5, 1 ), ( 7, 1 ), ( 1, 2 ) ]


getAnswerPart2 : String -> List ( Int, Int ) -> Int
getAnswerPart2 puzzle slopes =
    parsePuzzleInput puzzle
        |> expandPuzzle
        |> (\lines -> List.map (\( x, y ) -> calculate 0 x y x lines) slopes)
        |> multiplyTogether
